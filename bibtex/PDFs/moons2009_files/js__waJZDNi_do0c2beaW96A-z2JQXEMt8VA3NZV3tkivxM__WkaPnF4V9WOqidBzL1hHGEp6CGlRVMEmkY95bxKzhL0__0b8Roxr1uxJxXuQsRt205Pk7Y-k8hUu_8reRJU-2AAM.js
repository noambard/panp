/* Source and licensing information for the line(s) below can be found at http://www.bmj.com/sites/all/modules/highwire/highwire/plugins/highwire_markup_process/js/highwire_google_scholar_sprinkle.js. */
(function($){Drupal.behaviors.highwire_google_scholar={attach:function(context,settings){if($('.cit-extra').length>0)$('.cit-list .ref-cit').once('google_scholar_link',function(){$(this).each(function(){var authorList='',c=0;$(this).find('.cit-auth').each(function(){var given=$(this).find('.cit-name-given-names')!=='undefined'?$(this).find('.cit-name-given-names').html():'',surname=$(this).find('.cit-name-surname')!=='undefined'?$(this).find('.cit-name-surname').html():'';if(given||surname){authorList+='&author['+c+']='+(given?given:'')+(surname?'+'+surname:'')}else if($(this).hasClass('cit-collab'))authorList+='&author['+c+']='+$(this).text();c++});var articleTitle=$(this).find('.cit-article-title').length>0?$(this).find('.cit-article-title').text():false,articlePub=$(this).find('.cit-pub-date').length>0?$(this).find('.cit-pub-date').html():false,gs_link_suffix='';if(articleTitle!==false&&articlePub!==false&&authorList!==''){var gs={gsAuthor:authorList,gsTitle:articleTitle.replace(/< *img[^>]*src *= *["\']?([^"\']*)"\/>/i,'').replace(/\ /g,'+'),publicationYear:articlePub};extraFields={journal:$(this).find('.cit-jnl-abbrev').length>0?$(this).find('.cit-jnl-abbrev').html():false,volume:$(this).find('.cit-vol').length>0?$(this).find('.cit-vol').html():false,issn:$(this).find('.cit-issn').length>0?$(this).find('.cit-issn').html():false,isbn:$(this).find('.cit-isbn').length>0?$(this).find('.cit-isbn').html():false,doi:$(this).find('.cit-doi').length>0?$(this).find('.cit-doi').html():false,pages:($(this).find('.cit-fpage').length>0&&$(this).find('.cit-lpage').length>0)?$(this).find('.cit-fpage').html()+'-'+$(this).find('.cit-lpage').html():false};extraFieldString='';$.each(extraFields,function(idx,val){if(val!==false)extraFieldString+='&'+idx+'='+val.replace(/\ /g,'+')});gs_link_suffix=authorList+'&title='+gs.gsTitle+'&publication_year='+gs.publicationYear+extraFieldString}else{var q_text=$(this).find('cite').clone().remove().end().text();if(q_text.length){q_text=q_text.replace(/< *img[^>]*src *= *["\']?([^"\']*)"\/>/i,'');var q_split=q_text.split(' '),q_temp=[];$.each(q_split,function(idx,val){if(val!=='')q_temp.push(encodeURIComponent(val))});q_text=q_temp.join('+');gs_link_suffix='&q_txt='+q_text}};var gs_link='<a href="/lookup/google-scholar?link_type=googlescholar&gs_type=article'+gs_link_suffix+'" target="_blank" class="cit-ref-sprinkles cit-ref-sprinkles-google-scholar cit-ref-sprinkles-google-scholar"><span>Google Scholar</span></a>';$(this,context).once('custom-js',function(){$(this).find('.cit-extra').append(gs_link)})})})}}})(jQuery);;
/* Source and licensing information for the above line(s) can be found at http://www.bmj.com/sites/all/modules/highwire/highwire/plugins/highwire_markup_process/js/highwire_google_scholar_sprinkle.js. */
/* Source and licensing information for the line(s) below can be found at http://www.bmj.com/sites/all/modules/highwire/highwire/plugins/highwire_markup_process/js/highwire_openurl.js. */
(function($){Drupal.behaviors.highwire_openurl={attach:function(context,settings){if($('.cit-ref-sprinkles-open-url').length>0){var id='';if("apath"in Drupal.settings.highwire)id='?apath='+encodeURIComponent(Drupal.settings.highwire.apath);$.getJSON(Drupal.settings.basePath+'highwire/openurl_branding'+id,function(data){if(data){Drupal.settings.highwireOpenurl=data;if(data.base_url===null){$('.cit-ref-sprinkles-open-url').hide()}else $('.cit-ref-sprinkles-open-url').each(function(){var $link=$(this);$link.once('insertImage',function(){var branding=Drupal.settings.highwireOpenurl,href=$link.attr('href'),placeholder='',queryKey='';if(href.indexOf('{openurl}')!=-1){placeholder='{openurl}';href=decodeURIComponent(href);try{href=decodeURIComponent(href)}catch(e){}}else if(href.indexOf('urn:openurl:')!=-1){placeholder='urn:openurl:';queryKey='?'};href=href.replace('?query=','?');href=href.replace(placeholder,Drupal.settings.basePath+'highwire/openurl'+queryKey);var openurl_link=href+'&redirect_url='+branding.base_url;$link.attr('href',openurl_link.replace(/\+/g," "));$link.text(branding.link_text);if(branding.image)$link.prepend('<img src="'+branding.image+'"/>')})})}})}}}})(jQuery);;
/* Source and licensing information for the above line(s) can be found at http://www.bmj.com/sites/all/modules/highwire/highwire/plugins/highwire_markup_process/js/highwire_openurl.js. */
