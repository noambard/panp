(function(){"use strict";var WisePopsStorage={uid:'31007',siteHash:'FOt6c31007',cookieNamePersistent:'wisepops',cookieNameSession:'wisepops_session',cookieNameProperties:'wisepops_props',cookieNameNoShow:'wisepops_noshow',lastRequestInterval:null,persistentData:{'version':3,'uid':null,'ucrn':null,'last_req_date':null,'popins':{},'cross_subdomain':true},sessionData:{'is_new':0,'req_count':0,'popins':[]},customProperties:{},getCookie:function(cookieName){var name=cookieName+'=';var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' '){c=c.substring(1);}
if(c.indexOf(name)==0){c=c.substring(name.length,c.length);if(c.charAt(0)==='{'||c.charAt(0)==='['){c=unescape(c);}else{c=decodeURIComponent(c);}
return c;}}
return null;},setCookie:function(cookieName,value,isSessionOnly,skipPath){var expirationDate='expires=Mon, 18 Jan 2038 23:59:59 GMT;';if(isSessionOnly){if(typeof isSessionOnly==='number'){var d=new Date();d.setTime(d.getTime()+(isSessionOnly*24*60*60*1000));expirationDate='expires='+ d.toUTCString();}else{if(navigator.userAgent.toLowerCase().indexOf('chrome')!=-1){var d=new Date();d.setTime(d.getTime()+(2*60*60*1000));expirationDate='expires='+ d.toUTCString();}else{expirationDate='';}}}
var domain=window.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i);if(domain&&domain[0]&&(typeof isSessionOnly!=='number'||isSessionOnly>-365)&&this.getCrossSubDomain()){domain='domain=.'+ domain[0]+'; ';}else{domain='';}
var path='path=/; ';if(skipPath){if(typeof skipPath==='string'){path='path='+ skipPath+'; ';}else{path='';}}
var cookieValue=cookieName+"="+ encodeURIComponent(value)+"; "+ path+ domain+ expirationDate;if(cookieValue.length>4092){var error='Cookie size is too big ('+ cookieName+')';WisePopsApi.log('error',error);throw error;}
document.cookie=cookieValue;},getLastRequestInterval:function(){if(this.lastRequestInterval){return this.lastRequestInterval;}
if(this.persistentData.last_req_date){var lastReqDate=new Date(this.persistentData.last_req_date);var currentDate=new Date();var diff=Math.abs(currentDate.getTime()- lastReqDate.getTime());return Math.floor(diff/1000/60);}else{return 0;}},getPageViewCount:function(){if(this.sessionData.req_count){return this.sessionData.req_count;}else{return 0;}},incrementPageViewCount:function(){if(document.referrer==""||document.referrer.indexOf(document.location.host)!==-1){this.sessionData.req_count++;}else{this.sessionData.req_count=0;}
this._saveSession();},getDoNotDisplay:function(){return(this.getCookie(this.cookieNameNoShow)==1);},setDoNotDisplay:function(){this.setCookie(this.cookieNameNoShow,1,30);},setDisplayed:function(popId){var date=new Date();date.toJSON();if(this.getPopin(popId)){this.getPopin(popId).display_count++;this.getPopin(popId).display_date=date;}else{this.persistentData.popins[popId]={"display_count":1,"display_date":date};}
this._saveStored();this.addSessionPopinId(popId);return true;},getDisplayCount:function(popId){if(this.getPopin(popId)){if(this.getPopin(popId).display_count){return this.getPopin(popId).display_count;}else{return 0;}}},setConverted:function(popId){if(this.getPopin(popId)){var date=new Date();date.toJSON();this.getPopin(popId).converted=date;this._saveStored();return true;}else{return false;}},getLastDisplayedInterval:function(popId){if(this.getPopin(popId)){var diff=Math.abs(new Date(this.getPopin(popId).display_date)- new Date());return Math.floor((diff/1000)/ 60);
}else{return 0;}},isConverted:function(popId){return(this.getPopin(popId)&&this.getPopin(popId).converted);},getPopinIds:function(){var popinIds=[];for(var popId in this.persistentData.popins){popinIds.push(popId);}
return popinIds;},getSessionPopinIds:function(){return this.sessionData.popins;},addSessionPopinId:function(popId){if(this.sessionData.popins.indexOf(popId)==-1){this.sessionData.popins.push(popId);}
this._saveSession();},getPopin:function(popId){if(this.persistentData.popins[popId]){return this.persistentData.popins[popId];}},getLastDisplayedAndConvertedPopins:function(){var displayPopId=null;var displayDate=null;var convertPopId=null;var convertDate=null;var date=null;for(var popId in this.persistentData.popins){if(this.persistentData.popins.hasOwnProperty(popId)){date=new Date(this.persistentData.popins[popId].display_date);if(displayDate===null||date.getTime()>displayDate.getTime()){displayPopId=popId;displayDate=date;}
if(this.persistentData.popins[popId].converted){date=new Date(this.persistentData.popins[popId].converted);if(convertDate===null||date.getTime()>convertDate.getTime()){convertPopId=popId;convertDate=date;}}}}
return{displayPopId:displayPopId,displayDate:displayDate,convertPopId:convertPopId,convertDate:convertDate};},generateUcrn:function(){return this.persistentData.ucrn=Math.floor(Math.random()*100);},setNewVisitor:function(isNew){this.sessionData.is_new=(isNew||typeof isNew==='undefined')?1:0;this._saveSession();},getNewVisitor:function(){return(this.sessionData.is_new==1);},getUcrn:function(){if(this.persistentData.ucrn){return this.persistentData.ucrn;}
return false;},getCustomProperties:function(){for(var key in this.customProperties){if(this.customProperties.hasOwnProperty(key)){return this.customProperties;}}
return null;},addCustomProperties:function(properties,reset){if(reset){this.customProperties=properties;}else{for(var key in properties){if(properties.hasOwnProperty(key)){this.customProperties[key]=properties[key];}}}
this._saveCustomProperties();},dropCustomProperties:function(properties){for(var i=0;i<properties.length;i++){if(this.customProperties.hasOwnProperty(properties[i])){delete this.customProperties[properties[i]];}}
this._saveCustomProperties();},getCrossSubDomain:function(){if(typeof this.persistentData['cross_subdomain']!='undefined'){return this.persistentData['cross_subdomain'];}else{return true;}},setCrossSubDomain:function(crossSubDomain){this.persistentData['cross_subdomain']=crossSubDomain;},_init:function(){this._initStored();this._initSession();this._initCustomProperties();this._migrateCookieFormat();},_initStored:function(){var cookie=this.getCookie(this.cookieNamePersistent);if(cookie){try{cookie=JSON.parse(cookie);if(cookie.uid&&cookie.uid!=this.uid){WisePopsApi.log('error','Conflict between accounts: '+ cookie.uid+'/'+ this.uid);cookie.uid=this.uid;}
this.persistentData=cookie;}catch(exception){WisePopsApi.log('error','Cookie format corrupted');cookie=null;}}
if(!cookie){this.persistentData.uid=this.uid;this.generateUcrn();this.setNewVisitor(true);}
var date=new Date();this.lastRequestInterval=this.getLastRequestInterval();this.persistentData.last_req_date=date.toJSON();this._saveStored();if(!this.getCookie(this.cookieNamePersistent)&&this.getCrossSubDomain()){this.setCrossSubDomain(false);this._initStored();}},_initSession:function(){var cookie=this.getCookie(this.cookieNameSession);if(cookie){try{this.sessionData=JSON.parse(cookie);}catch(exception){cookie=null;}}},_initCustomProperties:function(){var cookie=this.getCookie(this.cookieNameProperties);if(cookie){try{this.customProperties=JSON.parse(cookie);}catch(exception){cookie=null;}}},_migrateCookieFormat:function(){var hasChange=false;if(this.persistentData['req_count_session']){hasChange=true;this.sessionData.req_count=this.persistentData['req_count_session'];delete this.persistentData['req_count'];delete this.persistentData['req_count_session'];}
if(!this.persistentData.uid){hasChange=true;this.persistentData.uid=this.uid;}
if(typeof this.persistentData['cross_subdomain']=='undefined'){hasChange=true;this.persistentData['cross_subdomain']=true;}
if(!this.persistentData['version']||this.persistentData['version']<3){hasChange=true;this.persistentData['version']=3;this.setCookie(this.cookieNamePersistent,'',-365);this.setCookie(this.cookieNameProperties,'',-365);this.setCookie(this.cookieNamePersistent,'',-365,true);this.setCookie(this.cookieNameProperties,'',-365,true);this.setCookie(this.cookieNamePersistent,'',-365,window.location.pathname);this.setCookie(this.cookieNameProperties,'',-365,window.location.pathname);}
if(hasChange){this._saveStored();this._saveSession();this._saveCustomProperties();}},_save:function(){this._saveStored();this._saveSession();},_saveStored:function(hasBeenReduced){try{var jsonData=JSON.stringify(this.persistentData);this.setCookie(this.cookieNamePersistent,jsonData);}catch(exception){if(!hasBeenReduced){this.persistentData.popins={};this._saveStored(true);}else{throw exception;}}},_saveSession:function(hasBeenReduced){try{var jsonData=JSON.stringify(this.sessionData);this.setCookie(this.cookieNameSession,jsonData,true);}catch(exception){if(!hasBeenReduced){this.sessionData.popins=[];this._saveSession(true);}else{throw exception;}}},_saveCustomProperties:function(){var jsonData=JSON.stringify(this.customProperties);if(jsonData.length<=2){this.setCookie(this.cookieNameProperties,'',-10);}else{this.setCookie(this.cookieNameProperties,jsonData);}}};var WisePopsApi={objectName:window['WisePopsObject'],object:null,disabled:false,pageviewCalled:false,logger:[],loggerMaxSize:1000,loggerLevels:['none','error','warn','info','debug','trace'],loggerDisplayLevel:null,_init:function(){if(!this.objectName){this._initObject();}
this.object=window[this.objectName];if(this.object._api){this.object._api.log('warn','Loader already initialized, consider using wisepops("pageview") instead');this.object._api.pageviewAction();}else{this.object._api=WisePopsApi;this.object._storage=WisePopsStorage;var insideIframe=false;try{insideIframe=(window.self!==window.top);}catch(e){insideIframe=true;}
if(navigator!=undefined&&navigator.cookieEnabled!=true){this.log('error','Cookies need to be enabled');this.disabled=true;}else if(insideIframe){this.log('info','Disabled inside iframe');this.disabled=true;}else if(WisePopsStorage.getDoNotDisplay()){this.log('info','Disabled for 30 days');this.disabled=true;}
this._initQueue();if(this.loggerDisplayLevel===null){this.logAction('error');}}},_initObject:function(){var retry=5;while((!this.objectName||window[this.objectName])&&retry--){this.objectName='wisepops'+ Math.floor(Math.random()*1000);}
if(window[this.objectName]){throw'Wisepops - Could not initialize function because of name conflict';}
var that=this;window['WisePopsObject']=this.objectName;window[this.objectName]=function(){(window[that.objectName].q=window[that.objectName].q||[]).push(arguments)};window[this.objectName].l=1*new Date();},_initQueue:function(){var that=this;this.object.q=this.object.q||[];var qOldPush=this.object.q.push;this.object.q.push=function(args){if(that.object.q.length){qOldPush.apply(that.object.q,arguments);}else{that._dispatch(args);}};this._initLoaderCallback();for(var i=0;i<this.object.q.length;i++){this._dispatch(this.object.q[i]);}
this.object.q.length=0;if(!this.pageviewCalled){this.pageviewAction();}},_initLoaderCallback:function(){var that=this;function executeLoaderCallback(callback){if(typeof callback==='function'){try{callback(that.object);}catch(exception){that.log('error','LoaderCallback - '+ exception);}}}
executeLoaderCallback(window['WisePopsLoaderCallback']);Object.defineProperty(window,'WisePopsLoaderCallback',{set:executeLoaderCallback});},_dispatch:function(args){this.log('debug','Dispatch',{functionName:args[0],properties:args[1],value:args[2]});var actionName=args[0]+'Action';if(!args[0]||!this[actionName]){this.log('error','Unkown method "'+ args[0]+'"');}else{this[actionName](args[1],args[2]);}},pageviewAction:function(){this.pageviewCalled=true;if(!this.disabled){WisePopsStorage.incrementPageViewCount();this._myWisepop();}},eventAction:function(eventName){if(!eventName||typeof eventName!='string'){this.log('error','Method "event" requires an event name as 2nd parameter');}else if(!this.disabled){if(eventName.length>50){this.log('warn','The event name cannot exceed 50 characters');eventName=eventName.substr(0,50);}
this._myWisepop(eventName);}},_myWisepop:function(event){var logMsg='Resolving display scenarios for '+(event?'custom event "'+ event+'"':'pageview');var customProperties=WisePopsStorage.getCustomProperties();this.log('info',logMsg,customProperties);var params={uid:WisePopsStorage.uid,site:WisePopsStorage.siteHash,ucrn:WisePopsStorage.getUcrn(),cnt_req:WisePopsStorage.getPageViewCount(),ref:document.referrer,url:document.location};if(WisePopsStorage.getLastRequestInterval()){params.last_req_int=WisePopsStorage.getLastRequestInterval();}
if(WisePopsStorage.getNewVisitor()){params['new']=1;}
if(event){params.e=event;}
if(WisePopsStorage.getPopinIds()){var popinIds=WisePopsStorage.getPopinIds();for(var i=0;i<popinIds.length;i++){var popinId=popinIds[i];params['d['+ popinId+']']=WisePopsStorage.getLastDisplayedInterval(popinId);if(WisePopsStorage.isConverted(popinId)){params['c['+ popinId+']']=1;}
params['dc['+ popinId+']']=WisePopsStorage.getDisplayCount(popinId);}}
var sessionPopins=WisePopsStorage.getSessionPopinIds();for(var i=0;i<sessionPopins.length;i++){params['ds['+ sessionPopins[i]+']']=1;}
if(customProperties){for(var key in customProperties){if(customProperties.hasOwnProperty(key)){params['p['+ encodeURIComponent(key)+']']=customProperties[key];}}}
this._myWisepopsCall(params);},_myWisepopsCall:function(params){var url='//popup.wisepops.com/my-wisepop';var paramString='';for(var key in params){if(params.hasOwnProperty(key)){paramString+=key+'='+ encodeURIComponent(params[key])+'&';}}
if(paramString.length){paramString=paramString.slice(0,-1);}
var xhr=null;if(window.XMLHttpRequest){xhr=new XMLHttpRequest();if(!("withCredentials"in xhr)){xhr=null;}else{xhr.withCredentials=true;}}
if(!xhr&&window.XDomainRequest){xhr=new XDomainRequest();this.log('info','Using XDomainRequest instead of XMLHttpRequest CORS');}
if(xhr){xhr.onload=function(){eval(this.responseText);};url+='?uid='+ params['uid'];xhr.open('POST',url,true);xhr.send(paramString);}else{this.log('warn','Cannot use XMLHttpRequest CORS');url+='?'+ paramString;var s=document.createElement('script');s.type='text/javascript';s.async=true;s.src=url;var s2=document.getElementsByTagName('script')[0];s2.parentNode.insertBefore(s,s2);}},propertiesAction:function(properties,reset){if(!properties||!(properties instanceof Object)){this.log('error','Method "properties" requires an object as 2nd parameter');}else{var verifiedProperties={};var droppedProperties=[];var allowedTypes=['string','number'];for(var key in properties){if(properties.hasOwnProperty(key)){if(properties[key]===null||properties[key]===undefined){droppedProperties.push(key);}else if(allowedTypes.indexOf(typeof properties[key])===-1&&!(properties[key]instanceof Date)){this.log('error','Property "'+ key+'" cannot an instance of "'+ typeof properties[key]+'"');}else if(key.length>50||properties[key].toString().length>255){this.log('error','Property "'+ key+'" is too long');}else{if(properties[key]instanceof Date){verifiedProperties[key]=properties[key].toJSON();}else{verifiedProperties[key]=properties[key];}}}}
if(!reset&&droppedProperties.length){WisePopsStorage.dropCustomProperties(droppedProperties);}
WisePopsStorage.addCustomProperties(verifiedProperties,reset);}},goalAction:function(goalName,revenue){if(goalName&&typeof goalName!=='string'){this.log('error','Method "goal" accepts a goal name as optional 2nd parameter');goalName=null;}else if(goalName&&goalName.length>50){this.log('warn','The goal name cannot exceed 50 characters');goalName=goalName.substr(0,50);}
if(revenue&&typeof revenue!=='number'){this.log('error','Method "goal" accepts a revenue amount as optional 3rd parameter');revenue=null;}
if(revenue&&revenue>1000000){this.log('warn','The revenue cannot exceed 1,000,000');revenue=1000000;}
var logMsg='Tracking goal';if(goalName){logMsg+=' named "'+ goalName+'"';}
if(revenue){logMsg+=' with revenue "'+ revenue+'"';}
this.log('info',logMsg);var lastPopins=WisePopsStorage.getLastDisplayedAndConvertedPopins();if(lastPopins.displayPopId||lastPopins.convertPopId){var params={e:'g'};if(goalName){params.n=goalName;}
if(revenue){params.r=revenue;}
if(lastPopins.displayPopId){params.pd=lastPopins.displayPopId;params.dd=lastPopins.displayDate.toJSON();}
if(lastPopins.convertPopId){params.pc=lastPopins.convertPopId;params.dc=lastPopins.convertDate.toJSON();}
this._trackCall(params);}},_trackCall:function(params,callback){callback=callback||function(){};var url='//tracking.wisepops.com/_.gif?';for(var key in params){if(params.hasOwnProperty(key)){url+=key+'='+ encodeURIComponent(params[key])+'&';}}
url=url.slice(0,-1);if(navigator.sendBeacon&&navigator.sendBeacon(url)){callback();}else{var tag=document.createElement('img');tag.onload=callback;tag.src=url;tag.style.display="none";document.body.appendChild(tag);}},logAction:function(level){if(!level||this.loggerLevels.indexOf(level)==-1){level='info';}
this.loggerDisplayLevel=this.loggerLevels.indexOf(level);for(var i=0;i<this.logger.length;i++){this._displayLogLine(this.logger[i]);}},log:function(level,message,properties){if(this.loggerLevels.indexOf(level)==-1){level='info';}
var line={level:this.loggerLevels.indexOf(level),msg:message,prop:properties};if(this.logger.length<this.loggerMaxSize){this.logger.push(line);}
this._displayLogLine(line);},_displayLogLine:function(line){if(this.loggerDisplayLevel!==null){if(line.level<=this.loggerDisplayLevel&&console[this.loggerLevels[line.level]]){var logLine='WisePops - '+ line.msg;if(line.prop){logLine={message:logLine,properties:line.prop};}
console[this.loggerLevels[line.level]](logLine);}}}};WisePopsStorage._init();WisePopsApi._init();})();var wiseStorage={isConverted:function(popId){return this._getObj()._storage.isConverted(popId);},setConverted:function(popId){return this._getObj()._storage.setConverted(popId);},setDisplayed:function(popId){return this._getObj()._storage.setDisplayed(popId);},_getObj:function(){return window[window['WisePopsObject']];}};function WisepopsAddToCookiePage(cookieName,value,isSessionOnly,raw){}